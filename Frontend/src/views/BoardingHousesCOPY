
import  '../style/boardinghouses.css';
import {useEffect, useState} from "react";
import {Link, useNavigate} from "react-router-dom";
import axiosClient from "../axiosClient.js";

export default function BoardingHouse() {
     const navigate = useNavigate();
     const [boardingHouses, setBoardingHouses] = useState([])
     const [loading, setLoading] = useState(false);


     //fetch all boarding houses from the backend
     useEffect(() => {
          getBH();
     }, []);


     const handleAddBoardingHouse = () => {
          navigate("/boardinghouse/new");
     };

     const onDeleteBH = bh => {
          if (!window.confirm("Are you sure you want to delete this boarding house?")) {
               return
          }

          axiosClient.delete(`/boardinghouse/${bh.id}`)
               .then(() => {
                    getBH();
               })

     }

     const getBH = () =>{
          setLoading(true)

          axiosClient.get('/boardinghouse')
               .then(({data}) => {
                    setLoading(false)
                    setBoardingHouses(data); //store the result
               })
               .catch(() => {
                    console.error("failed to load boarding houses")
                    setLoading(false)
               })
     }

     return (
          <div className="card animated fadeInDown">
               {boardingHouses.length === 0 ? (
                    <div className="no-boarding-house-card">
                         <p>You havenâ€™t added any boarding house yet.</p><br/>
                         <Link className="btn-add" to="/boardinghouse/new">Add new</Link>
                    </div>
               ) : (
                    <div className="boarding-house-list">
                         <h2>Boarding houses</h2>
                         <button onClick={handleAddBoardingHouse} className="add-btn">+ Add Boarding Houses</button>
                         <table>
                              <thead>
                              <tr>
                                   <th>Name</th>
                                   <th>Location</th>
                                   <th>Rooms</th>
                                   <th>Action</th>

                              </tr>
                              </thead>
                              {loading &&
                                  <tbody>
                                  <tr>
                                      <td colSpan="5" className="text-center">
                                          Loading...
                                      </td>
                                  </tr>
                                  </tbody>
                              }
                              {!loading &&
                              <tbody>
                              {boardingHouses.map((bh) => (
                                   <tr key={bh.id}>
                                        <td>{bh.name}</td>
                                        <td>{bh.location}</td>
                                        <td>{bh.rooms}</td>
                                        <td>
                                             <Link className="btn-edit" to={'/boardinghouse/' + bh.id}>Edit</Link>
                                             &nbsp;
                                             <button className="btn-delete" onClick={ev => onDeleteBH(bh)}>Delete</button>
                                        </td>
                                   </tr>
                              ))}
                              </tbody>
                              }
                         </table>
                    </div>
               )}
          </div>
     );
}